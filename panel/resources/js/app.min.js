function modUrl(a,b){return a=a.replace("/^https?:/",""),a=-1!=a.search(/\/(s|p)\d{3}x\d{3}\//)?a.replace(/\/(s|p)\d{3}x\d{3}\//,"/"+b+"/"):a.replace(/\/(?!.*\/)/,"/"+b+"/")}function transition(a,b,c){Dimg.style.left=a+"px",Dimg.style.top=b+"px",Dimg.style.transform="rotate("+c+"deg)",Dimg.style.webkitTransform="rotate("+c+"deg)"}function play(){Dimg.addEventListener("transitionend",newPic,!1),transition(Xfin,Yfin,Rotfin)}function pause(){if(Dimg.removeEventListener("transitionend",newPic,!1),Dimg.style.left=window.getComputedStyle(Dimg).getPropertyValue("left"),Dimg.style.top=window.getComputedStyle(Dimg).getPropertyValue("top"),window.getComputedStyle(Dimg).getPropertyValue("transform"))var a=window.getComputedStyle(Dimg).getPropertyValue("transform").match(/\(([^,]+), ?([^,]+),/);else var a=window.getComputedStyle(Dimg).getPropertyValue("-webkit-transform").match(/\(([^,]+), ?([^,]+),/);var b=Math.round(Math.atan2(a[2],a[1])*(180/Math.PI));Dimg.style.transform="rotate("+b+"deg)",Dimg.style.webkitTransform="rotate("+b+"deg)";var c=(3*(Yfin-parseFloat(Dimg.style.top))/(Yfin-Yini)).toFixed(2);Dimg.style.transition="transform "+c+"s, left "+c+"s, top "+c+"s",Dimg.style.webkitTransition="-webkit-transform "+c+"s, left "+c+"s, top "+c+"s"}function restart(){$container.empty(),n=0,list.shuffle(),extendList()}function fullScreen(){document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function normalScreen(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function polaroid(){document.body.classList.add("showPolaroid")}function noPolaroid(){document.body.classList.remove("showPolaroid")}function albumSelected(a){var b=a.currentTarget;0==listAlchecked[b.id.slice(1)]?(b.children[1].setAttribute("class","albumSelected"),listAlchecked[b.id.slice(1)]=1):(b.children[1].setAttribute("class","albumNotSelected"),listAlchecked[b.id.slice(1)]=0)}function FchooseAccept(){listTmp=new Array;for(var a=0;a<listAlchecked.length;a++)if(1==listAlchecked[a])for(var b=0;b<fbList[a][3].length;b++)listTmp.push(fbList[a][3][b]);0==listTmp.length?alert("Debes seleccionar al menos un album"):($container.empty(),n=0,list=listTmp,list.shuffle(),extendList(),$blackout.hide(),$albumChoose.hide())}function FchooseCancel(){$blackout.hide(),$albumChoose.hide(),play()}function loadAlbumChoose(){if(nAlPic>0&&nAlPic<=fbList.length&&(dimgAl.style.backgroundImage='url("'+fbList[nAlPic-1][2]+'")'),nAlPic<fbList.length){var a=document.createElement("div");a.setAttribute("id","a"+nAlPic),a.setAttribute("class","divPhoto"),a.addEventListener("click",albumSelected,!1),dimgAl=document.createElement("div"),a.appendChild(dimgAl),TimgAl=document.createElement("div"),nAlPic<fbList.length-2?(TimgAl.setAttribute("class","albumSelected"),listAlchecked[nAlPic]=1):(TimgAl.setAttribute("class","albumNotSelected"),listAlchecked[nAlPic]=0),a.appendChild(TimgAl);var b=document.createElement("img");b.addEventListener("load",loadAlbumChoose,!1),b.addEventListener("error",loadAlbumChoose,!1),b.src=fbList[nAlPic][2];var c=document.createElement("span");c.innerHTML=fbList[nAlPic][1],a.appendChild(c),$albumChoose.append(a)}else{var d=document.createElement("div"),e=document.createElement("div");e.setAttribute("class","BtnChoose"),e.innerHTML="Aceptar",e.addEventListener("click",FchooseAccept,!1);var f=document.createElement("div");f.setAttribute("class","BtnChoose"),f.innerHTML="Cancelar",f.addEventListener("click",FchooseCancel,!1),d.appendChild(e),d.appendChild(f),$albumChoose.append(d),onInit&&(onInit=!1,getFriendList())}nAlPic++}function filterAlbum(){$albumChoose.is(":hidden")?($friendsChoose.is(":visible")&&$friendsChoose.hide(),pause(),$blackout.show(),$albumChoose.show()):($blackout.hide(),$albumChoose.hide(),play())}function friendSelected(a){var b=a.currentTarget;b.id.slice(1)!=nFrSelected&&(b.children[1].setAttribute("class","albumSelected"),document.getElementById("f"+nFrSelected).children[1].setAttribute("class","albumNotSelected"),nFrSelected=parseInt(b.id.slice(1)))}function FfriendsAccept(){$blackout.hide(),$friendsChoose.hide(),$container.empty(),n=0,nAl=0,list=new Array,$albumChoose.empty(),nAlPic=0,listAlchecked=new Array,newFriend=1,fbListSaved=!1;for(var a=0;a<allFbList.length;a++)if(allFbList[a].id==friendList[nFrSelected][0]){fbList=allFbList[a].fbList,fbListSaved=!0;break}fbListSaved?makePhotoList():($loader.show(),$loadingAlbums.hide(),fbList=new Array,appInit())}function FfriendsCancel(){$blackout.hide(),$friendsChoose.hide(),play()}function getFriendList(){FB.api("me/friends?fields=name,id&limit=5000",function(a){for(var b=0;b<a.data.length;b++)friendList[b+1]=new Array,friendList[b+1][0]=a.data[b].id,friendList[b+1][1]=a.data[b].name;loadFriendsChoose()})}function loadFriendsChoose(){if(nFr>0&&nFr<=friendList.length&&(dimgFr.style.backgroundImage='url("https://graph.facebook.com/'+friendList[nFr-1][0]+'/picture?width=100&height=100")'),nFr<friendList.length){var a=document.createElement("div");a.setAttribute("id","f"+nFr),a.setAttribute("class","divPhoto"),a.addEventListener("click",friendSelected,!1),dimgFr=document.createElement("div"),a.appendChild(dimgFr),TimgAl=document.createElement("div"),0==nFr?TimgAl.setAttribute("class","albumSelected"):TimgAl.setAttribute("class","albumNotSelected"),a.appendChild(TimgAl);var b=document.createElement("img");b.addEventListener("load",loadFriendsChoose,!1),b.addEventListener("error",loadFriendsChoose,!1),b.src="https://graph.facebook.com/"+friendList[nFr][0]+"/picture?width=100&height=100";var c=document.createElement("span");c.innerHTML=friendList[nFr][1],a.appendChild(c),$friendsChoose.append(a)}else{var d=document.createElement("div"),e=document.createElement("div");e.setAttribute("class","BtnChoose"),e.innerHTML="Aceptar",e.addEventListener("click",FfriendsAccept,!1);var f=document.createElement("div");f.setAttribute("class","BtnChoose"),f.innerHTML="Cancelar",f.addEventListener("click",FfriendsCancel,!1),d.appendChild(e),d.appendChild(f),$friendsChoose.append(d)}nFr++}function friends(){$friendsChoose.is(":hidden")?($albumChoose.is(":visible")&&$albumChoose.hide(),pause(),$("#controls").css("background-color","rgba(0, 0, 0, 0.6)"),$blackout.show(),friendsChoose.show()):($("#controls").css("background-color",""),$blackout.hide(),friendsChoose.hide())}Array.prototype.swap=function(a,b){var c=this[a];this[a]=b,this[b]=c},Array.prototype.shuffle=function(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=this.length-1);for(var c,d,e=a;b>e;e++)c=Math.floor(Math.random()*(b-e))+e+1,d=this[e],this[e]=this[c],this[c]=d};var nAlPic=0,listAlchecked=new Array,dimgAl,newFriend=1,onInit=!0,nFr=0,nFrSelected=0,fbListSaved=!1,friendList=[[]];friendList[0][1]="Me";var dimgFr;